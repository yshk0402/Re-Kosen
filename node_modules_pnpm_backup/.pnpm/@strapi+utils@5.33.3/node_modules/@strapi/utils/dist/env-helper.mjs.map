{"version":3,"file":"env-helper.mjs","sources":["../src/env-helper.ts"],"sourcesContent":["import _ from 'lodash';\n\nexport type Env = typeof envFn & typeof utils;\n\nfunction envFn(key: string): string | undefined;\nfunction envFn(key: string, defaultValue: string): string;\nfunction envFn<T>(key: string, defaultValue: T): string | T;\nfunction envFn(key: string, defaultValue?: any): any {\n  return _.has(process.env, key) ? process.env[key] : defaultValue;\n}\n\nfunction getKey(key: string) {\n  return process.env[key] ?? '';\n}\n\nfunction int(key: string, defaultValue: number): number;\nfunction int(key: string, defaultValue?: number | undefined): number | undefined;\nfunction int(key: string, defaultValue?: number | undefined): number | undefined {\n  if (!_.has(process.env, key)) {\n    return defaultValue;\n  }\n\n  return parseInt(getKey(key), 10);\n}\n\nfunction float(key: string, defaultValue: number): number;\nfunction float(key: string, defaultValue?: number | undefined): number | undefined;\nfunction float(key: string, defaultValue?: number): number | undefined {\n  if (!_.has(process.env, key)) {\n    return defaultValue;\n  }\n\n  return parseFloat(getKey(key));\n}\n\nfunction bool(key: string, defaultValue: boolean): boolean;\nfunction bool(key: string, defaultValue?: boolean | undefined): boolean | undefined;\nfunction bool(key: string, defaultValue?: boolean): boolean | undefined {\n  if (!_.has(process.env, key)) {\n    return defaultValue;\n  }\n\n  return getKey(key) === 'true';\n}\n\nfunction json<T extends object>(key: string, defaultValue: T): T;\nfunction json<T extends object>(key: string, defaultValue?: T | undefined): T | undefined;\nfunction json(key: string, defaultValue?: object) {\n  if (!_.has(process.env, key)) {\n    return defaultValue;\n  }\n\n  try {\n    return JSON.parse(getKey(key));\n  } catch (error) {\n    if (error instanceof Error) {\n      throw new Error(`Invalid json environment variable ${key}: ${error.message}`);\n    }\n\n    throw error;\n  }\n}\n\nfunction array(key: string, defaultValue: string[]): string[];\nfunction array(key: string, defaultValue?: string[] | undefined): string[] | undefined;\nfunction array(key: string, defaultValue?: string[]): string[] | undefined {\n  if (!_.has(process.env, key)) {\n    return defaultValue;\n  }\n\n  let value = getKey(key);\n\n  if (value.startsWith('[') && value.endsWith(']')) {\n    value = value.substring(1, value.length - 1);\n  }\n\n  return value.split(',').map((v) => {\n    return _.trim(_.trim(v, ' '), '\"');\n  });\n}\n\nfunction date(key: string, defaultValue: Date): Date;\nfunction date(key: string, defaultValue?: Date | undefined): Date | undefined;\nfunction date(key: string, defaultValue?: Date): Date | undefined {\n  if (!_.has(process.env, key)) {\n    return defaultValue;\n  }\n\n  return new Date(getKey(key));\n}\n\n/**\n * Gets a value from env that matches oneOf provided values\n * @param {string} key\n * @param {string[]} expectedValues\n * @param {string|undefined} defaultValue\n * @returns {string|undefined}\n */\nfunction oneOf<T extends string, TDefault extends T = T>(\n  key: string,\n  expectedValues: T[],\n  defaultValue: TDefault\n): T;\nfunction oneOf<T extends string, TDefault extends T = T>(\n  key: string,\n  expectedValues: T[],\n  defaultValue?: TDefault | undefined\n): T | undefined;\nfunction oneOf(key: string, expectedValues?: string[], defaultValue?: string) {\n  if (!expectedValues) {\n    throw new Error(`env.oneOf requires expectedValues`);\n  }\n\n  if (defaultValue && !expectedValues.includes(defaultValue)) {\n    throw new Error(`env.oneOf requires defaultValue to be included in expectedValues`);\n  }\n\n  const rawValue = env(key, defaultValue);\n  if (rawValue !== undefined && expectedValues.includes(rawValue)) {\n    return rawValue;\n  }\n\n  return defaultValue;\n}\n\nconst utils = {\n  int,\n  float,\n  bool,\n  json,\n  array,\n  date,\n  oneOf,\n};\n\nconst env: Env = Object.assign(envFn, utils);\n\nexport default env;\n"],"names":["envFn","key","defaultValue","_","has","process","env","getKey","int","parseInt","float","parseFloat","bool","json","JSON","parse","error","Error","message","array","value","startsWith","endsWith","substring","length","split","map","v","trim","date","Date","oneOf","expectedValues","includes","rawValue","undefined","utils","Object","assign"],"mappings":"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"}