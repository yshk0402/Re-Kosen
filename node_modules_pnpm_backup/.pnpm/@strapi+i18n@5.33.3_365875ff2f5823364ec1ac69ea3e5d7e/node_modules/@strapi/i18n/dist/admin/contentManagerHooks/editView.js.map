{"version":3,"file":"editView.js","sources":["../../../admin/src/contentManagerHooks/editView.tsx"],"sourcesContent":["/* eslint-disable check-file/filename-naming-convention */\nimport { Flex, Tooltip, VisuallyHidden } from '@strapi/design-system';\nimport { Earth } from '@strapi/icons';\nimport { MessageDescriptor, useIntl } from 'react-intl';\nimport { styled } from 'styled-components';\n\nimport { getTranslation } from '../utils/getTranslation';\n\nimport type { EditFieldLayout, EditLayout } from '@strapi/content-manager/strapi-admin';\ninterface MutateEditViewArgs {\n  layout: EditLayout;\n}\n\nconst mutateEditViewHook = ({ layout }: MutateEditViewArgs): MutateEditViewArgs => {\n  // If i18n isn't explicitly enabled on the content type, then no field can be localized\n  if (\n    !('i18n' in layout.options) ||\n    (typeof layout.options.i18n === 'object' &&\n      layout.options.i18n !== null &&\n      'localized' in layout.options.i18n &&\n      !layout.options.i18n.localized)\n  ) {\n    return { layout };\n  }\n\n  const decorateField = (field: EditFieldLayout) => addLabelActionToField(field, layout);\n\n  const components = Object.entries(layout.components).reduce<EditLayout['components']>(\n    (acc, [key, componentLayout]) => {\n      return {\n        ...acc,\n        [key]: {\n          ...componentLayout,\n          layout: componentLayout.layout.map((row) => row.map(decorateField)),\n        },\n      };\n    },\n    {}\n  );\n\n  return {\n    layout: {\n      ...layout,\n      components,\n      layout: layout.layout.map((panel) => panel.map((row) => row.map(decorateField))),\n    },\n  } satisfies Pick<MutateEditViewArgs, 'layout'>;\n};\n\nconst isFieldLocalized = (attribute: EditFieldLayout['attribute'], layout: EditLayout) => {\n  const contentTypeLocalized =\n    !!(layout.options as any)?.i18n && !!(layout.options as any).i18n.localized;\n\n  if (!contentTypeLocalized) {\n    return false;\n  }\n\n  const pluginOptions =\n    attribute && typeof attribute === 'object' && 'pluginOptions' in (attribute as object)\n      ? (attribute as { pluginOptions?: { i18n?: { localized?: boolean } } }).pluginOptions\n      : undefined;\n\n  return pluginOptions?.i18n?.localized === true;\n};\n\nconst addLabelActionToField = (field: EditFieldLayout, layout: EditLayout) => {\n  const localized = isFieldLocalized(field.attribute, layout);\n\n  if (!localized) {\n    return field;\n  }\n\n  const title: MessageDescriptor = {\n    id: getTranslation('Field.localized'),\n    defaultMessage: 'This value is unique for the selected locale',\n  };\n\n  return {\n    ...field,\n    labelAction: <LabelAction title={title} />,\n  };\n};\n\n/* -------------------------------------------------------------------------------------------------\n * LabelAction\n * -----------------------------------------------------------------------------------------------*/\n\ninterface LabelActionProps {\n  title: MessageDescriptor;\n}\n\nconst LabelAction = ({ title }: LabelActionProps) => {\n  const { formatMessage } = useIntl();\n\n  return (\n    <Span tag=\"span\" title={title}>\n      <VisuallyHidden tag=\"span\">{formatMessage(title)}</VisuallyHidden>\n      <Tooltip label={formatMessage(title)}>\n        <Earth aria-hidden focusable={false} />\n      </Tooltip>\n    </Span>\n  );\n};\n\nconst Span = styled(Flex)`\n  svg {\n    width: 12px;\n    height: 12px;\n\n    fill: ${({ theme }) => theme.colors.neutral500};\n\n    path {\n      fill: ${({ theme }) => theme.colors.neutral500};\n    }\n  }\n`;\n\nexport { mutateEditViewHook };\n"],"names":["mutateEditViewHook","layout","options","i18n","localized","decorateField","field","addLabelActionToField","components","Object","entries","reduce","acc","key","componentLayout","map","row","panel","isFieldLocalized","attribute","contentTypeLocalized","pluginOptions","undefined","title","id","getTranslation","defaultMessage","labelAction","_jsx","LabelAction","formatMessage","useIntl","_jsxs","Span","tag","VisuallyHidden","Tooltip","label","Earth","aria-hidden","focusable","styled","Flex","theme","colors","neutral500"],"mappings":"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"}