{"version":3,"file":"DataManagerProvider.mjs","sources":["../../../../admin/src/components/DataManager/DataManagerProvider.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport {\n  useStrapiApp,\n  useNotification,\n  useAppInfo,\n  useFetchClient,\n  useAuth,\n  adminApi,\n  useGuidedTour,\n  GUIDED_TOUR_REQUIRED_ACTIONS,\n} from '@strapi/admin/strapi-admin';\nimport groupBy from 'lodash/groupBy';\nimport isEqual from 'lodash/isEqual';\nimport mapValues from 'lodash/mapValues';\nimport { useIntl } from 'react-intl';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useLocation } from 'react-router-dom';\n\nimport { getTrad } from '../../utils/getTrad';\nimport { useAutoReloadOverlayBlocker } from '../AutoReloadOverlayBlocker';\nimport { useCTBTracking } from '../CTBSession/ctbSession';\nimport { useCTBSession } from '../CTBSession/useCTBSession';\nimport { useFormModalNavigation } from '../FormModalNavigation/useFormModalNavigation';\n\nimport { DataManagerContext, type DataManagerContextValue } from './DataManagerContext';\nimport { actions, initialState, type State } from './reducer';\nimport { useServerRestartWatcher } from './useServerRestartWatcher';\nimport { sortContentType, stateToRequestData } from './utils/cleanData';\nimport { retrieveComponentsThatHaveComponents } from './utils/retrieveComponentsThatHaveComponents';\nimport { retrieveNestedComponents } from './utils/retrieveNestedComponents';\nimport { retrieveSpecificInfoFromComponents } from './utils/retrieveSpecificInfoFromComponents';\n\nimport type { ContentTypes, ContentType, Components } from '../../types';\nimport type { FormAPI } from '../../utils/formAPI';\nimport type { Internal } from '@strapi/types';\n\ninterface DataManagerProviderProps {\n  children: React.ReactNode;\n}\n\nconst selectState = (state: Record<string, unknown>) =>\n  (state['content-type-builder_dataManagerProvider'] || initialState) as State;\n\nconst DataManagerProvider = ({ children }: DataManagerProviderProps) => {\n  const dispatch = useDispatch();\n  const state = useSelector(selectState);\n  const dispatchGuidedTour = useGuidedTour('DataManagerProvider', (s) => s.dispatch);\n  const location = useLocation();\n  const { sessionId: ctbSessionId, regenerateSessionId } = useCTBSession();\n\n  const {\n    components,\n    contentTypes,\n    reservedNames,\n    initialComponents,\n    initialContentTypes,\n    isLoading,\n  } = state.current;\n\n  const { toggleNotification } = useNotification();\n  const { lockAppWithAutoreload, unlockAppWithAutoreload } = useAutoReloadOverlayBlocker();\n  const serverRestartWatcher = useServerRestartWatcher();\n\n  const getPlugin = useStrapiApp('DataManagerProvider', (state) => state.getPlugin);\n  const plugin = getPlugin('content-type-builder');\n  const autoReload = useAppInfo('DataManagerProvider', (state) => state.autoReload);\n  const { formatMessage } = useIntl();\n  const { trackUsage } = useCTBTracking();\n  const refetchPermissions = useAuth('DataManagerProvider', (state) => state.refetchPermissions);\n  const { onCloseModal } = useFormModalNavigation();\n\n  const [isSaving, setIsSaving] = React.useState(false);\n  const previousLocationRef = React.useRef<string | null>(null);\n\n  const isModified = React.useMemo(() => {\n    return !(isEqual(components, initialComponents) && isEqual(contentTypes, initialContentTypes));\n  }, [components, contentTypes, initialComponents, initialContentTypes]);\n\n  const fetchClient = useFetchClient();\n\n  const isInDevelopmentMode = autoReload;\n\n  const getDataRef = React.useRef<any>();\n\n  getDataRef.current = async () => {\n    try {\n      const [schemaResponse, reservedNamesResponse] = await Promise.all([\n        fetchClient.get(`/content-type-builder/schema`),\n        fetchClient.get(`/content-type-builder/reserved-names`),\n      ]);\n\n      const { components, contentTypes } = schemaResponse.data.data;\n\n      dispatch(\n        actions.init({\n          components: mapValues(components, (component) => ({\n            ...component,\n            status: 'UNCHANGED',\n          })) as Components,\n          contentTypes: mapValues(contentTypes, (contentType) => ({\n            ...contentType,\n            status: 'UNCHANGED',\n          })) as ContentTypes,\n          reservedNames: reservedNamesResponse.data,\n        })\n      );\n\n      dispatch(actions.clearHistory());\n    } catch (err) {\n      console.error({ err });\n      toggleNotification({\n        type: 'danger',\n        message: formatMessage({ id: 'notification.error', defaultMessage: 'An error occurred' }),\n      });\n    }\n  };\n\n  React.useEffect(() => {\n    getDataRef.current();\n    previousLocationRef.current = location.pathname;\n\n    return () => {\n      // Reload the plugin so the cycle is new again\n      dispatch(actions.reloadPlugin());\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Detect navigation away and back to CTB to regenerate session\n  React.useEffect(() => {\n    const currentPath = location.pathname;\n    const previousPath = previousLocationRef.current;\n    const CTB_PATH = '/plugins/content-type-builder';\n\n    if (previousPath) {\n      const isCTBPath = currentPath.includes(CTB_PATH);\n      const wasCTBPath = previousPath.includes(CTB_PATH);\n\n      // Regenerate session when returning to CTB after navigating away\n      if (!wasCTBPath && isCTBPath) {\n        regenerateSessionId();\n      }\n    }\n\n    previousLocationRef.current = currentPath;\n  }, [location.pathname, regenerateSessionId]);\n\n  React.useEffect(() => {\n    if (!autoReload) {\n      toggleNotification({\n        type: 'info',\n        message: formatMessage({ id: getTrad('notification.info.autoreaload-disable') }),\n      });\n    }\n  }, [autoReload, toggleNotification, formatMessage]);\n\n  const getAllComponentsThatHaveAComponentInTheirAttributes = (components: Components) => {\n    const composWithCompos = retrieveComponentsThatHaveComponents(components);\n\n    return composWithCompos;\n  };\n\n  const getAllNestedComponents = (components: Components) => {\n    const appNestedCompo = retrieveNestedComponents(components);\n\n    return appNestedCompo;\n  };\n\n  const updatePermissions = async () => {\n    await refetchPermissions();\n  };\n\n  const saveSchema = async () => {\n    setIsSaving(true);\n\n    const PluginForms = plugin?.apis?.forms as FormAPI;\n\n    const mutatedCTs = Object.entries(state.current.contentTypes).reduce(\n      (acc, [uid, contentType]) => {\n        acc[uid] = PluginForms.mutateContentTypeSchema(\n          contentType,\n          initialContentTypes[uid]\n        ) as ContentType;\n\n        return acc;\n      },\n      {} as ContentTypes\n    );\n\n    const { requestData, trackingEventProperties } = stateToRequestData({\n      components: state.current.components,\n      contentTypes: mutatedCTs,\n    });\n\n    // Track that the save button was clicked (includes session ID via useCTBTracking)\n    trackUsage('willUpdateCTBSchema', {\n      ...trackingEventProperties,\n      ctbSessionId,\n    });\n\n    const isSendingContentTypes = Object.keys(state.current.contentTypes).length > 0;\n\n    lockAppWithAutoreload();\n\n    try {\n      await fetchClient.post(`/content-type-builder/update-schema`, { data: requestData });\n\n      if (isSendingContentTypes) {\n        // Note: didCreateGuidedTourCollectionType doesn't accept properties\n        trackUsage('didCreateGuidedTourCollectionType');\n      }\n\n      // Make sure the server has restarted\n      await serverRestartWatcher();\n      // Generate new session ID after server restart\n      regenerateSessionId();\n      // refetch and update initial state after the data has been saved\n      await getDataRef.current();\n      // Update the app's permissions\n      await updatePermissions();\n    } catch (err) {\n      console.error({ err });\n      toggleNotification({\n        type: 'danger',\n        message: formatMessage({ id: 'notification.error', defaultMessage: 'An error occurred' }),\n      });\n\n      trackUsage('didUpdateCTBSchema', {\n        ...trackingEventProperties,\n        success: false,\n        ctbSessionId,\n      });\n    } finally {\n      setIsSaving(false);\n      unlockAppWithAutoreload();\n\n      dispatch(adminApi.util.invalidateTags(['GuidedTourMeta', 'HomepageKeyStatistics']));\n      dispatchGuidedTour({\n        type: 'set_completed_actions',\n        payload: [GUIDED_TOUR_REQUIRED_ACTIONS.contentTypeBuilder.createSchema],\n      });\n\n      trackUsage('didUpdateCTBSchema', {\n        ...trackingEventProperties,\n        success: true,\n        ctbSessionId,\n      });\n    }\n  };\n\n  const componentsThatHaveOtherComponentInTheirAttributes = React.useMemo(() => {\n    return getAllComponentsThatHaveAComponentInTheirAttributes(components);\n  }, [components]);\n\n  const nestedComponents = React.useMemo(() => {\n    return getAllNestedComponents(components);\n  }, [components]);\n\n  const allComponentsCategories = React.useMemo(() => {\n    return retrieveSpecificInfoFromComponents(components, ['category']);\n  }, [components]);\n\n  const componentsGroupedByCategory = React.useMemo(() => {\n    return groupBy(components, 'category');\n  }, [components]);\n\n  const sortedContentTypesList = React.useMemo(() => {\n    return sortContentType(contentTypes);\n  }, [contentTypes]);\n\n  const context: DataManagerContextValue = {\n    componentsThatHaveOtherComponentInTheirAttributes,\n    nestedComponents,\n    saveSchema,\n    reservedNames,\n    components,\n    contentTypes,\n    initialComponents,\n    initialContentTypes,\n    isSaving,\n    isModified,\n    isInDevelopmentMode,\n    allComponentsCategories,\n    componentsGroupedByCategory,\n    sortedContentTypesList,\n    isLoading,\n    addAttribute(payload) {\n      dispatch(actions.addAttribute(payload));\n    },\n    editAttribute(payload) {\n      dispatch(actions.editAttribute(payload));\n    },\n    addCustomFieldAttribute(payload) {\n      dispatch(actions.addCustomFieldAttribute(payload));\n    },\n    editCustomFieldAttribute(payload) {\n      dispatch(actions.editCustomFieldAttribute(payload));\n    },\n    addCreatedComponentToDynamicZone(payload) {\n      dispatch(actions.addCreatedComponentToDynamicZone(payload));\n    },\n    createSchema(payload) {\n      dispatch(actions.createSchema(payload));\n    },\n    createComponentSchema({ data, uid, componentCategory }) {\n      dispatch(actions.createComponentSchema({ data, uid, componentCategory }));\n    },\n    changeDynamicZoneComponents({ forTarget, targetUid, dynamicZoneTarget, newComponents }) {\n      dispatch(\n        actions.changeDynamicZoneComponents({\n          forTarget,\n          targetUid,\n          dynamicZoneTarget,\n          newComponents,\n        })\n      );\n    },\n    removeAttribute(payload) {\n      if (payload.forTarget === 'contentType') {\n        // Note: willDeleteFieldOfContentType doesn't accept properties\n        trackUsage('willDeleteFieldOfContentType');\n      }\n\n      dispatch(actions.removeField(payload));\n    },\n    removeComponentFromDynamicZone(payload) {\n      dispatch(actions.removeComponentFromDynamicZone(payload));\n    },\n    deleteComponent(uid: Internal.UID.Component) {\n      const userConfirm = window.confirm(\n        formatMessage({\n          id: getTrad(`popUpWarning.bodyMessage.component.delete`),\n        })\n      );\n\n      if (userConfirm) {\n        onCloseModal();\n\n        dispatch(actions.deleteComponent(uid));\n      }\n    },\n    deleteContentType(uid: Internal.UID.ContentType) {\n      const userConfirm = window.confirm(\n        formatMessage({\n          id: getTrad(`popUpWarning.bodyMessage.contentType.delete`),\n        })\n      );\n\n      if (userConfirm) {\n        onCloseModal();\n\n        dispatch(actions.deleteContentType(uid));\n      }\n    },\n\n    updateComponentSchema({ data, componentUID }) {\n      dispatch(\n        actions.updateComponentSchema({\n          data,\n          uid: componentUID,\n        })\n      );\n    },\n\n    updateComponentUid({ componentUID, newComponentUID }) {\n      dispatch(\n        actions.updateComponentUid({\n          uid: componentUID,\n          newComponentUID,\n        })\n      );\n    },\n\n    updateSchema(args) {\n      dispatch(actions.updateSchema(args));\n    },\n\n    moveAttribute(args) {\n      dispatch(actions.moveAttribute(args));\n    },\n\n    applyChange(args) {\n      dispatch(actions.applyChange(args));\n    },\n\n    history: {\n      undo() {\n        dispatch(actions.undo());\n      },\n\n      redo() {\n        dispatch(actions.redo());\n      },\n\n      discardAllChanges() {\n        dispatch(actions.discardAll());\n      },\n\n      canUndo: state.past.length > 0,\n      canRedo: state.future.length > 0,\n      canDiscardAll: isModified,\n    },\n  };\n\n  return <DataManagerContext.Provider value={context}>{children}</DataManagerContext.Provider>;\n};\n\n// eslint-disable-next-line import/no-default-export\nexport default DataManagerProvider;\n"],"names":["selectState","state","initialState","DataManagerProvider","children","dispatch","useDispatch","useSelector","dispatchGuidedTour","useGuidedTour","s","location","useLocation","sessionId","ctbSessionId","regenerateSessionId","useCTBSession","components","contentTypes","reservedNames","initialComponents","initialContentTypes","isLoading","current","toggleNotification","useNotification","lockAppWithAutoreload","unlockAppWithAutoreload","useAutoReloadOverlayBlocker","serverRestartWatcher","useServerRestartWatcher","getPlugin","useStrapiApp","plugin","autoReload","useAppInfo","formatMessage","useIntl","trackUsage","useCTBTracking","refetchPermissions","useAuth","onCloseModal","useFormModalNavigation","isSaving","setIsSaving","React","useState","previousLocationRef","useRef","isModified","useMemo","isEqual","fetchClient","useFetchClient","isInDevelopmentMode","getDataRef","schemaResponse","reservedNamesResponse","Promise","all","get","data","actions","init","mapValues","component","status","contentType","clearHistory","err","console","error","type","message","id","defaultMessage","useEffect","pathname","reloadPlugin","currentPath","previousPath","CTB_PATH","isCTBPath","includes","wasCTBPath","getTrad","getAllComponentsThatHaveAComponentInTheirAttributes","composWithCompos","retrieveComponentsThatHaveComponents","getAllNestedComponents","appNestedCompo","retrieveNestedComponents","updatePermissions","saveSchema","PluginForms","apis","forms","mutatedCTs","Object","entries","reduce","acc","uid","mutateContentTypeSchema","requestData","trackingEventProperties","stateToRequestData","isSendingContentTypes","keys","length","post","success","adminApi","util","invalidateTags","payload","GUIDED_TOUR_REQUIRED_ACTIONS","contentTypeBuilder","createSchema","componentsThatHaveOtherComponentInTheirAttributes","nestedComponents","allComponentsCategories","retrieveSpecificInfoFromComponents","componentsGroupedByCategory","groupBy","sortedContentTypesList","sortContentType","context","addAttribute","editAttribute","addCustomFieldAttribute","editCustomFieldAttribute","addCreatedComponentToDynamicZone","createComponentSchema","componentCategory","changeDynamicZoneComponents","forTarget","targetUid","dynamicZoneTarget","newComponents","removeAttribute","removeField","removeComponentFromDynamicZone","deleteComponent","userConfirm","window","confirm","deleteContentType","updateComponentSchema","componentUID","updateComponentUid","newComponentUID","updateSchema","args","moveAttribute","applyChange","history","undo","redo","discardAllChanges","discardAll","canUndo","past","canRedo","future","canDiscardAll","_jsx","DataManagerContext","Provider","value"],"mappings":"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"}