{"version":3,"file":"ListView.mjs","sources":["../../../../admin/src/pages/ListView/ListView.tsx"],"sourcesContent":["/* eslint-disable import/no-default-export */\nimport { Layouts, tours } from '@strapi/admin/strapi-admin';\nimport { Box, Button, Flex, Typography } from '@strapi/design-system';\nimport { Information, Pencil, Plus } from '@strapi/icons';\nimport upperFirst from 'lodash/upperFirst';\nimport { useIntl } from 'react-intl';\nimport { Navigate, useParams } from 'react-router-dom';\nimport { styled } from 'styled-components';\n\nimport { useCTBTracking } from '../../components/CTBSession/ctbSession';\nimport { useDataManager } from '../../components/DataManager/useDataManager';\nimport { useFormModalNavigation } from '../../components/FormModalNavigation/useFormModalNavigation';\nimport { List } from '../../components/List';\nimport { getTrad } from '../../utils/getTrad';\n\nimport { LinkToCMSettingsView } from './LinkToCMSettingsView';\n\nimport type { Internal } from '@strapi/types';\n\nconst LayoutsHeaderCustom = styled(Layouts.Header)`\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`;\n\nconst ListView = () => {\n  const { isInDevelopmentMode, contentTypes, components, isLoading } = useDataManager();\n  const { formatMessage } = useIntl();\n  const { trackUsage } = useCTBTracking();\n\n  const { contentTypeUid, componentUid } = useParams<{\n    contentTypeUid: Internal.UID.ContentType;\n    componentUid: Internal.UID.Component;\n  }>();\n\n  const { onOpenModalAddComponentsToDZ, onOpenModalAddField, onOpenModalEditSchema } =\n    useFormModalNavigation();\n\n  const type = contentTypeUid\n    ? contentTypes[contentTypeUid]\n    : componentUid\n      ? components[componentUid]\n      : null;\n\n  if (isLoading) {\n    return null;\n  }\n\n  if (!type) {\n    const allowedEndpoints = Object.values(contentTypes)\n      .filter((ct) => ct.visible === true && !ct.plugin)\n      .map((ct) => ct.uid)\n      .sort();\n\n    if (allowedEndpoints.length > 0) {\n      return <Navigate to={`/plugins/content-type-builder/content-types/${allowedEndpoints[0]}`} />;\n    }\n\n    return <Navigate to=\"/plugins/content-type-builder/content-types/create-content-type\" />;\n  }\n\n  if (contentTypeUid && type.modelType === 'contentType' && type.visible === false) {\n    return (\n      <Navigate to=\"/plugins/content-type-builder/content-types/create-content-type\" replace />\n    );\n  }\n\n  const isFromPlugin = 'plugin' in type && type?.plugin !== undefined;\n\n  const forTarget = contentTypeUid ? 'contentType' : 'component';\n\n  const label = type?.info?.displayName ?? '';\n\n  const canEdit = isInDevelopmentMode && !isFromPlugin;\n\n  const handleClickAddComponentToDZ = (dynamicZoneTarget?: string) => {\n    onOpenModalAddComponentsToDZ({ dynamicZoneTarget, targetUid: type.uid });\n  };\n\n  const onEdit = () => {\n    if ('kind' in type) {\n      if (type?.kind === 'collectionType') {\n        trackUsage('willEditNameOfContentType');\n      }\n\n      if (type?.kind === 'singleType') {\n        trackUsage('willEditNameOfSingleType');\n      }\n\n      onOpenModalEditSchema({\n        modalType: forTarget,\n        forTarget: forTarget,\n        targetUid: type.uid,\n        kind: type?.kind,\n      });\n\n      return;\n    }\n\n    onOpenModalEditSchema({\n      modalType: forTarget,\n      forTarget: forTarget,\n      targetUid: type.uid,\n    });\n  };\n\n  const addNewFieldLabel = formatMessage({\n    id: getTrad('table.button.no-fields'),\n    defaultMessage: 'Add new field',\n  });\n\n  const addAnotherFieldLabel = formatMessage({\n    id: getTrad('button.attributes.add.another'),\n    defaultMessage: 'Add another field',\n  });\n\n  const isDeleted = type.status === 'REMOVED';\n\n  const primaryAction = isInDevelopmentMode && (\n    <Flex gap={2}>\n      <LinkToCMSettingsView\n        key=\"link-to-cm-settings-view\"\n        type={type}\n        disabled={type.status === 'NEW' || isDeleted}\n      />\n      <Button\n        startIcon={<Pencil />}\n        variant=\"tertiary\"\n        onClick={onEdit}\n        disabled={!canEdit || isDeleted}\n      >\n        {formatMessage({\n          id: 'app.utils.edit',\n          defaultMessage: 'Edit',\n        })}\n      </Button>\n\n      <Button\n        startIcon={<Plus />}\n        variant=\"secondary\"\n        minWidth=\"max-content\"\n        onClick={() => {\n          onOpenModalAddField({ forTarget, targetUid: type.uid });\n        }}\n        disabled={isDeleted}\n      >\n        {type.attributes.length === 0 ? addNewFieldLabel : addAnotherFieldLabel}\n      </Button>\n    </Flex>\n  );\n\n  return (\n    <>\n      <tours.contentTypeBuilder.Introduction>\n        {/* Invisible Anchor */}\n        <Box />\n      </tours.contentTypeBuilder.Introduction>\n      {isDeleted && (\n        <Flex background=\"danger100\" justifyContent={'center'} padding={4}>\n          <Flex gap={2}>\n            <Information fill=\"danger600\" height=\"2rem\" width=\"2rem\" />\n            <Typography>\n              {formatMessage(\n                {\n                  id: getTrad('table.warning.deleted'),\n                  defaultMessage: `This {kind} has been deleted`,\n                },\n                {\n                  kind: type.modelType === 'contentType' ? 'Content Type' : 'Component',\n                }\n              )}\n            </Typography>\n          </Flex>\n        </Flex>\n      )}\n      <LayoutsHeaderCustom id=\"title\" primaryAction={primaryAction} title={upperFirst(label)} />\n      <Layouts.Content>\n        <Box\n          background=\"neutral0\"\n          shadow=\"filterShadow\"\n          hasRadius\n          overflow=\"auto\"\n          borderColor=\"neutral150\"\n        >\n          <List type={type} addComponentToDZ={handleClickAddComponentToDZ} isMain />\n        </Box>\n      </Layouts.Content>\n    </>\n  );\n};\n\nexport default ListView;\n"],"names":["LayoutsHeaderCustom","styled","Layouts","Header","ListView","isInDevelopmentMode","contentTypes","components","isLoading","useDataManager","formatMessage","useIntl","trackUsage","useCTBTracking","contentTypeUid","componentUid","useParams","onOpenModalAddComponentsToDZ","onOpenModalAddField","onOpenModalEditSchema","useFormModalNavigation","type","allowedEndpoints","Object","values","filter","ct","visible","plugin","map","uid","sort","length","_jsx","Navigate","to","modelType","replace","isFromPlugin","undefined","forTarget","label","info","displayName","canEdit","handleClickAddComponentToDZ","dynamicZoneTarget","targetUid","onEdit","kind","modalType","addNewFieldLabel","id","getTrad","defaultMessage","addAnotherFieldLabel","isDeleted","status","primaryAction","_jsxs","Flex","gap","LinkToCMSettingsView","disabled","Button","startIcon","Pencil","variant","onClick","Plus","minWidth","attributes","_Fragment","tours","contentTypeBuilder","Introduction","Box","background","justifyContent","padding","Information","fill","height","width","Typography","title","upperFirst","Content","shadow","hasRadius","overflow","borderColor","List","addComponentToDZ","isMain"],"mappings":"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"}