{"version":3,"file":"AIUploadModal.js","sources":["../../../../admin/src/ai/components/AIUploadModal.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport { createContext, useNotification } from '@strapi/admin/strapi-admin';\nimport { Alert, Button, Flex, Modal } from '@strapi/design-system';\nimport { produce } from 'immer';\nimport { useIntl } from 'react-intl';\nimport { styled } from 'styled-components';\n\nimport {\n  AddAssetStep,\n  FileWithRawFile,\n} from '../../components/UploadAssetDialog/AddAssetStep/AddAssetStep';\nimport { useBulkEdit } from '../../hooks/useBulkEdit';\nimport { useTracking } from '../../hooks/useTracking';\nimport { useUpload } from '../../hooks/useUpload';\nimport { getTrad } from '../../utils';\n\nimport { AIAssetCard, AIAssetCardSkeletons } from './AIAssetCard';\n\nimport type { File } from '../../../../shared/contracts/files';\n\n/* -------------------------------------------------------------------------------------------------\n * ModalBody\n * -----------------------------------------------------------------------------------------------*/\n\nconst StyledModalBody = styled(Modal.Body)`\n  padding: 0;\n  display: flex;\n  justify-content: center;\n\n  [data-radix-scroll-area-viewport] {\n    padding-top: ${({ theme }) => theme.spaces[6]};\n    padding-bottom: ${({ theme }) => theme.spaces[6]};\n    padding-left: ${({ theme }) => theme.spaces[7]};\n    padding-right: ${({ theme }) => theme.spaces[7]};\n  }\n`;\n\nconst StyledAlert = styled(Alert)`\n  & > button {\n    display: none;\n  }\n`;\n\nconst ModalContent = ({ onClose }: Pick<AIUploadModalProps, 'onClose'>) => {\n  const { formatMessage } = useIntl();\n  const { toggleNotification } = useNotification();\n  const state = useAIUploadModalContext('ModalContent', (s) => s.state);\n  const dispatch = useAIUploadModalContext('ModalContent', (s) => s.dispatch);\n  const folderId = useAIUploadModalContext('ModalContent', (s) => s.folderId);\n  const { upload } = useUpload();\n  const { edit, isLoading: isSaving } = useBulkEdit();\n  const [isUploading, setIsUploading] = React.useState(false);\n  const [uploadError, setUploadError] = React.useState<Error | null>(null);\n  const { trackUsage } = useTracking();\n\n  const handleCaptionChange = (assetId: number, caption: string) => {\n    dispatch({\n      type: 'set_uploaded_asset_caption',\n      payload: { id: assetId, caption },\n    });\n  };\n\n  const handleAltTextChange = (assetId: number, altText: string) => {\n    dispatch({\n      type: 'set_uploaded_asset_alt_text',\n      payload: { id: assetId, altText },\n    });\n  };\n\n  const resetState = () => {\n    dispatch({ type: 'set_uploaded_assets', payload: [] });\n  };\n\n  const handleFinish = async () => {\n    if (state.hasUnsavedChanges) {\n      const assetsToUpdate = state.uploadedAssets.filter(\n        (asset) => (asset.wasCaptionChanged || asset.wasAltTextChanged) && asset.file.id\n      );\n\n      if (assetsToUpdate.length > 0) {\n        if (assetsToUpdate.some((asset) => asset.wasCaptionChanged)) {\n          trackUsage('didEditAICaption');\n        }\n\n        if (assetsToUpdate.some((asset) => asset.wasAltTextChanged)) {\n          trackUsage('didEditAIAlternativeText');\n        }\n\n        // Update assets\n        const updates = assetsToUpdate.map((asset) => ({\n          id: asset.file.id!,\n          fileInfo: {\n            name: asset.file.name,\n            alternativeText: asset.file.alternativeText ?? null,\n            caption: asset.file.caption ?? null,\n            folder:\n              typeof asset.file.folder === 'object' && asset.file.folder !== null\n                ? // @ts-expect-error types are wrong\n                  asset.file.folder.id\n                : asset.file.folder,\n          },\n        }));\n\n        try {\n          await edit(updates);\n          dispatch({ type: 'clear_unsaved_changes' });\n        } catch (err) {\n          toggleNotification({\n            type: 'danger',\n            message:\n              (err instanceof Error ? err.message : null) ||\n              formatMessage({ id: 'notification.error', defaultMessage: 'An error occurred' }),\n          });\n          return; // Don't close modal on error\n        }\n      }\n    }\n\n    resetState();\n    onClose();\n  };\n\n  const handleCancel = () => {\n    resetState();\n    onClose();\n  };\n\n  const handleUpload = async (assets: FileWithRawFile[]) => {\n    dispatch({ type: 'set_assets_to_upload_length', payload: assets.length });\n    setUploadError(null);\n    setIsUploading(true);\n\n    try {\n      const assetsForUpload = assets.map((asset) => ({\n        ...asset,\n        id: asset.id ? Number(asset.id) : undefined,\n      }));\n\n      const uploadedFiles = await upload(assetsForUpload, folderId);\n      const filesWithFolder = uploadedFiles.map((file: File) => ({\n        ...file,\n        // The upload API doesn't populate the folder relation, so we add it manually\n        folder: folderId || file.folder,\n      }));\n      dispatch({ type: 'set_uploaded_assets', payload: filesWithFolder });\n    } catch (error) {\n      console.error('Upload failed:', error);\n      setUploadError(error instanceof Error ? error : new Error('Upload failed'));\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  if (state.assetsToUploadLength === 0) {\n    return (\n      <Modal.Content>\n        <AddAssetStep onClose={onClose} onAddAsset={handleUpload} />\n      </Modal.Content>\n    );\n  }\n\n  if (\n    isUploading ||\n    (state.assetsToUploadLength > 0 && state.uploadedAssets.length === 0 && !uploadError)\n  ) {\n    return (\n      <Modal.Content>\n        <Modal.Header>\n          <Modal.Title>\n            {formatMessage({\n              id: getTrad('ai.modal.uploading.title'),\n              defaultMessage: 'Uploading and processing with AI...',\n            })}\n          </Modal.Title>\n        </Modal.Header>\n        <StyledModalBody>\n          <AIAssetCardSkeletons count={state.assetsToUploadLength} />\n        </StyledModalBody>\n      </Modal.Content>\n    );\n  }\n\n  const title = formatMessage(\n    {\n      id: getTrad('ai.modal.title'),\n      defaultMessage:\n        '{count, plural, one {# asset uploaded} other {# assets uploaded}}, review AI generated metadata',\n    },\n    { count: state.uploadedAssets.length }\n  );\n\n  if (uploadError) {\n    return (\n      <Modal.Content>\n        <Modal.Header>\n          <Modal.Title>{title}</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <StyledAlert closeLabel=\"\" variant=\"danger\">\n            {formatMessage({\n              id: getTrad('ai.modal.error'),\n              defaultMessage: 'Could not generate AI metadata for the uploaded files.',\n            })}\n          </StyledAlert>\n        </Modal.Body>\n        <Modal.Footer>\n          <Button onClick={handleCancel} variant=\"tertiary\">\n            {formatMessage({ id: 'cancel', defaultMessage: 'Cancel' })}\n          </Button>\n          <Button onClick={handleFinish} loading={isSaving}>\n            {formatMessage({ id: 'global.finish', defaultMessage: 'Finish' })}\n          </Button>\n        </Modal.Footer>\n      </Modal.Content>\n    );\n  }\n\n  return (\n    <Modal.Content>\n      <Modal.Header>\n        <Modal.Title>{title}</Modal.Title>\n      </Modal.Header>\n\n      <StyledModalBody>\n        <Flex gap={6} direction=\"column\" alignItems=\"stretch\">\n          {state.uploadedAssets.map(({ file: asset, wasCaptionChanged, wasAltTextChanged }) => (\n            <AIAssetCard\n              key={asset.id}\n              asset={asset}\n              onCaptionChange={(caption: string) =>\n                asset.id && handleCaptionChange(asset.id, caption)\n              }\n              onAltTextChange={(altText: string) =>\n                asset.id && handleAltTextChange(asset.id, altText)\n              }\n              wasCaptionChanged={wasCaptionChanged}\n              wasAltTextChanged={wasAltTextChanged}\n            />\n          ))}\n        </Flex>\n      </StyledModalBody>\n\n      <Modal.Footer>\n        <Button onClick={handleCancel} variant=\"tertiary\">\n          {formatMessage({ id: 'cancel', defaultMessage: 'Cancel' })}\n        </Button>\n        <Button onClick={handleFinish} loading={isSaving}>\n          {formatMessage({ id: 'global.finish', defaultMessage: 'Finish' })}\n        </Button>\n      </Modal.Footer>\n    </Modal.Content>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * UploadModal\n * -----------------------------------------------------------------------------------------------*/\n\ninterface AIUploadModalProps {\n  open: boolean;\n  onClose: () => void;\n  folderId?: number | null;\n}\n\ntype State = {\n  uploadedAssets: Array<{ file: File; wasCaptionChanged: boolean; wasAltTextChanged: boolean }>;\n  assetsToUploadLength: number;\n  hasUnsavedChanges: boolean;\n};\n\ntype Action =\n  | {\n      type: 'set_uploaded_assets';\n      payload: File[];\n    }\n  | {\n      type: 'set_assets_to_upload_length';\n      payload: number;\n    }\n  | {\n      type: 'set_uploaded_asset_caption';\n      payload: { id: number; caption: string };\n    }\n  | {\n      type: 'set_uploaded_asset_alt_text';\n      payload: { id: number; altText: string };\n    }\n  | {\n      type: 'remove_uploaded_asset';\n      payload: { id: number };\n    }\n  | {\n      type: 'edit_uploaded_asset';\n      payload: { editedAsset: File };\n    }\n  | {\n      type: 'clear_unsaved_changes';\n    };\n\nconst [AIUploadModalContext, useAIUploadModalContext] = createContext<{\n  state: State;\n  dispatch: React.Dispatch<Action>;\n  folderId: number | null;\n  onClose: () => void;\n}>('AIUploadModalContext');\n\nconst reducer = (state: State, action: Action): State => {\n  return produce(state, (draft: State) => {\n    if (action.type === 'set_uploaded_assets') {\n      draft.uploadedAssets = action.payload.map((file) => ({\n        file,\n        wasCaptionChanged: false,\n        wasAltTextChanged: false,\n      }));\n      draft.hasUnsavedChanges = false;\n    }\n\n    if (action.type === 'set_assets_to_upload_length') {\n      draft.assetsToUploadLength = action.payload;\n    }\n\n    if (action.type === 'set_uploaded_asset_caption') {\n      const asset = draft.uploadedAssets.find((a) => a.file.id === action.payload.id);\n      if (asset && asset.file.caption !== action.payload.caption) {\n        asset.file.caption = action.payload.caption;\n        asset.wasCaptionChanged = true;\n        draft.hasUnsavedChanges = true;\n      }\n    }\n\n    if (action.type === 'set_uploaded_asset_alt_text') {\n      const asset = draft.uploadedAssets.find((a) => a.file.id === action.payload.id);\n      if (asset && asset.file.alternativeText !== action.payload.altText) {\n        asset.file.alternativeText = action.payload.altText;\n        asset.wasAltTextChanged = true;\n        draft.hasUnsavedChanges = true;\n      }\n    }\n\n    if (action.type === 'remove_uploaded_asset') {\n      draft.uploadedAssets = draft.uploadedAssets.filter((a) => a.file.id !== action.payload.id);\n    }\n\n    if (action.type === 'edit_uploaded_asset') {\n      const assetIndex = draft.uploadedAssets.findIndex(\n        (a) => a.file.id === action.payload.editedAsset.id\n      );\n      if (assetIndex !== -1) {\n        draft.uploadedAssets[assetIndex] = {\n          file: action.payload.editedAsset,\n          wasCaptionChanged: draft.uploadedAssets[assetIndex].wasCaptionChanged,\n          wasAltTextChanged: draft.uploadedAssets[assetIndex].wasAltTextChanged,\n        };\n      }\n    }\n\n    if (action.type === 'clear_unsaved_changes') {\n      draft.hasUnsavedChanges = false;\n      draft.uploadedAssets.forEach((asset) => {\n        asset.wasCaptionChanged = false;\n        asset.wasAltTextChanged = false;\n      });\n    }\n  });\n};\n\nexport const AIUploadModal = ({ open, onClose, folderId = null }: AIUploadModalProps) => {\n  const [state, dispatch] = React.useReducer(reducer, {\n    uploadedAssets: [],\n    assetsToUploadLength: 0,\n    hasUnsavedChanges: false,\n  });\n\n  const handleClose = React.useCallback(() => {\n    // Reset state when modal closes\n    dispatch({ type: 'set_uploaded_assets', payload: [] });\n    onClose();\n  }, [onClose]);\n\n  return (\n    <AIUploadModalContext\n      state={state}\n      dispatch={dispatch}\n      folderId={folderId}\n      onClose={handleClose}\n    >\n      <Modal.Root open={open} onOpenChange={handleClose}>\n        <ModalContent onClose={handleClose} />\n      </Modal.Root>\n    </AIUploadModalContext>\n  );\n};\n\nexport { useAIUploadModalContext };\n"],"names":["StyledModalBody","styled","Modal","Body","theme","spaces","StyledAlert","Alert","ModalContent","onClose","formatMessage","useIntl","toggleNotification","useNotification","state","useAIUploadModalContext","s","dispatch","folderId","upload","useUpload","edit","isLoading","isSaving","useBulkEdit","isUploading","setIsUploading","React","useState","uploadError","setUploadError","trackUsage","useTracking","handleCaptionChange","assetId","caption","type","payload","id","handleAltTextChange","altText","resetState","handleFinish","hasUnsavedChanges","assetsToUpdate","uploadedAssets","filter","asset","wasCaptionChanged","wasAltTextChanged","file","length","some","updates","map","fileInfo","name","alternativeText","folder","err","message","Error","defaultMessage","handleCancel","handleUpload","assets","assetsForUpload","Number","undefined","uploadedFiles","filesWithFolder","error","console","assetsToUploadLength","_jsx","Content","AddAssetStep","onAddAsset","_jsxs","Header","Title","getTrad","AIAssetCardSkeletons","count","title","closeLabel","variant","Footer","Button","onClick","loading","Flex","gap","direction","alignItems","AIAssetCard","onCaptionChange","onAltTextChange","AIUploadModalContext","createContext","reducer","action","produce","draft","find","a","assetIndex","findIndex","editedAsset","forEach","AIUploadModal","open","useReducer","handleClose","useCallback","Root","onOpenChange"],"mappings":"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"}