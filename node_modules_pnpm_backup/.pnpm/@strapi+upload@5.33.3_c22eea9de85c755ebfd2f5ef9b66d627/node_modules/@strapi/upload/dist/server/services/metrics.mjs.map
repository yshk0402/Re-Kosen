{"version":3,"file":"metrics.mjs","sources":["../../../server/src/services/metrics.ts"],"sourcesContent":["import type { Core } from '@strapi/types';\nimport { Settings } from '../controllers/validation/admin/settings';\n\nconst getProviderName = () => strapi.config.get('plugin::upload.provider', 'local');\nconst isProviderPrivate = async () => strapi.plugin('upload').provider.isPrivate();\n\nexport default ({ strapi }: { strapi: Core.Strapi }) => ({\n  async trackUsage(event: string, properties?: Record<string, any>) {\n    const settings: Settings = await strapi.plugin('upload').service('upload').getSettings();\n    const isAIAvailable =\n      strapi.config.get('admin.ai.enabled', true) && strapi.ee.features.isEnabled('cms-ai');\n\n    return strapi.telemetry.send(event, {\n      ...properties,\n      eventProperties: {\n        ...properties?.eventProperties,\n        ...(isAIAvailable ? { isAIMediaLibraryConfigured: Boolean(settings.aiMetadata) } : {}),\n      },\n    });\n  },\n  async sendUploadPluginMetrics() {\n    const uploadProvider = getProviderName();\n    const privateProvider = await isProviderPrivate();\n\n    await this.trackUsage('didInitializePluginUpload', {\n      groupProperties: {\n        uploadProvider,\n        privateProvider,\n      },\n    });\n  },\n});\n"],"names":["getProviderName","strapi","config","get","isProviderPrivate","plugin","provider","isPrivate","trackUsage","event","properties","settings","service","getSettings","isAIAvailable","ee","features","isEnabled","telemetry","send","eventProperties","isAIMediaLibraryConfigured","Boolean","aiMetadata","sendUploadPluginMetrics","uploadProvider","privateProvider","groupProperties"],"mappings":"AAGA,MAAMA,kBAAkB,IAAMC,MAAAA,CAAOC,MAAM,CAACC,GAAG,CAAC,yBAA2B,EAAA,OAAA,CAAA;AAC3E,MAAMC,iBAAAA,GAAoB,UAAYH,MAAOI,CAAAA,MAAM,CAAC,QAAUC,CAAAA,CAAAA,QAAQ,CAACC,SAAS,EAAA;AAEhF,cAAe,CAAA,CAAC,EAAEN,QAAAA,OAAM,EAA2B,IAAM;QACvD,MAAMO,UAAAA,CAAAA,CAAWC,KAAa,EAAEC,UAAgC,EAAA;YAC9D,MAAMC,QAAAA,GAAqB,MAAMV,OAAOI,CAAAA,MAAM,CAAC,QAAUO,CAAAA,CAAAA,OAAO,CAAC,QAAA,CAAA,CAAUC,WAAW,EAAA;AACtF,YAAA,MAAMC,aACJb,GAAAA,OAAAA,CAAOC,MAAM,CAACC,GAAG,CAAC,kBAAA,EAAoB,IAASF,CAAAA,IAAAA,OAAAA,CAAOc,EAAE,CAACC,QAAQ,CAACC,SAAS,CAAC,QAAA,CAAA;AAE9E,YAAA,OAAOhB,OAAOiB,CAAAA,SAAS,CAACC,IAAI,CAACV,KAAO,EAAA;AAClC,gBAAA,GAAGC,UAAU;gBACbU,eAAiB,EAAA;AACf,oBAAA,GAAGV,YAAYU,eAAe;AAC9B,oBAAA,GAAIN,aAAgB,GAAA;wBAAEO,0BAA4BC,EAAAA,OAAAA,CAAQX,SAASY,UAAU;AAAE,qBAAA,GAAI;AACrF;AACF,aAAA,CAAA;AACF,SAAA;QACA,MAAMC,uBAAAA,CAAAA,GAAAA;AACJ,YAAA,MAAMC,cAAiBzB,GAAAA,eAAAA,EAAAA;AACvB,YAAA,MAAM0B,kBAAkB,MAAMtB,iBAAAA,EAAAA;AAE9B,YAAA,MAAM,IAAI,CAACI,UAAU,CAAC,2BAA6B,EAAA;gBACjDmB,eAAiB,EAAA;AACfF,oBAAAA,cAAAA;AACAC,oBAAAA;AACF;AACF,aAAA,CAAA;AACF;AACF,KAAA,CAAC;;;;"}